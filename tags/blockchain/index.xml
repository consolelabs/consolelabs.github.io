<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>blockchain on Console Labs</title><link>https://log.console.so/tags/blockchain/</link><description>Recent content in blockchain on Console Labs</description><generator>Hugo -- gohugo.io</generator><language>en-us</language><lastBuildDate>Mon, 11 Sep 2023 00:00:00 +0000</lastBuildDate><atom:link href="https://log.console.so/tags/blockchain/index.xml" rel="self" type="application/rss+xml"/><item><title>Integrate new chain</title><link>https://log.console.so/playbook/add-new-chains/</link><pubDate>Mon, 11 Sep 2023 00:00:00 +0000</pubDate><guid>https://log.console.so/playbook/add-new-chains/</guid><description>&lt;p>by hnh, vhbien&lt;/p>
&lt;p>In the rapidly evolving blockchain industry, it&amp;rsquo;s crucial to keep up with the pace of change. Here&amp;rsquo;s a quick overview of how we seamlessly integrate new chains into the Mochi system, with the caveat that this method is specific to EVM-based blockchains:&lt;/p>
&lt;ul>
&lt;li>&lt;input disabled="" type="checkbox"> Product Preparation&lt;/li>
&lt;li>&lt;input disabled="" type="checkbox"> Pull raw data into clickhouse&lt;/li>
&lt;li>&lt;input disabled="" type="checkbox"> Ticker, Watchlist Token Info&lt;/li>
&lt;li>&lt;input disabled="" type="checkbox"> Wallet tracking on this new chain&lt;/li>
&lt;li>&lt;input disabled="" type="checkbox"> Show assets in profile&lt;/li>
&lt;li>&lt;input disabled="" type="checkbox"> Transfer / Tip / Airdrop / Payme / Paylink&lt;/li>
&lt;li>&lt;input disabled="" type="checkbox"> Withdraw&lt;/li>
&lt;li>&lt;input disabled="" type="checkbox"> Deposit&lt;/li>
&lt;/ul>
&lt;h3 id="0-product-preparation">[0] Product Preparation &lt;a href="#0-product-preparation">&lt;/a>&lt;/h3>
&lt;p>In this section, most of the tasks require manual handling.&lt;/p>
&lt;p>&lt;strong>Add new chain to supported chain list&lt;/strong>&lt;/p>
&lt;ol>
&lt;li>Go to &lt;a href="https://github.com/consolelabs/mochi-pay-api">Mochi Pay&lt;/a> repository.&lt;/li>
&lt;li>Create a migration file as show below.&lt;/li>
&lt;/ol>
&lt;pre>&lt;code class="language-sql">INSERT INTO &amp;quot;public&amp;quot;.&amp;quot;product_supported_chains&amp;quot; (&amp;quot;chain_id&amp;quot;, &amp;quot;name&amp;quot;, &amp;quot;symbol&amp;quot;, &amp;quot;rpc&amp;quot;, &amp;quot;explorer&amp;quot;, &amp;quot;icon&amp;quot;, &amp;quot;is_evm&amp;quot;,) VALUES
('1', 'Ethereum Mainnet', 'ETH', 'https://eth.llamarpc.com', 'https://etherscan.io', 'https://cdn.discordapp.com/emojis/928216430451761172.png?size=240&amp;amp;quality=lossless', 't'),
&lt;/code>&lt;/pre>
&lt;ol start="3">
&lt;li>use the &lt;code>/chains&lt;/code> command to see the new changes.&lt;/li>
&lt;/ol>
&lt;p>&lt;strong>Add token emojis&lt;/strong>
To enhance the aesthetics of Mochi, we aim to display token emojis whenever possible. Currently, please reach out to &lt;code>@minh_cloud&lt;/code> for assistance with this task.&lt;/p>
&lt;h3 id="1-pull-raw-data-into-clickhouse">[1] Pull raw data into clickhouse &lt;a href="#1-pull-raw-data-into-clickhouse">&lt;/a>&lt;/h3>
&lt;p>To store blockchain raw events data in ClickHouse, follow these steps:&lt;/p>
&lt;ol>
&lt;li>Go to &lt;a href="https://github.com/consolelabs/infrastructure">Infras&lt;/a> repository&lt;/li>
&lt;li>Create a service with the following configuration, similar to the &lt;a href="https://github.com/consolelabs/infrastructure/tree/main/data-warehouse">example&lt;/a>&lt;/li>
&lt;/ol>
&lt;pre>&lt;code class="language-yaml">evm:
chainName: base
chainId: 8453
rpcServers:
- https://1rpc.io/base
- https://base.meowrpc.com
- https://mainnet.base.org
- https://base.blockpi.network/v1/rpc/public
syncFromBlockNumber: 2769582
&lt;/code>&lt;/pre>
&lt;h3 id="2-ticker-watchlist-and-token-info">[2] Ticker, watchlist and Token info &lt;a href="#2-ticker-watchlist-and-token-info">&lt;/a>&lt;/h3>
&lt;p>This step should work automatically. Simply go to Mochi Clients and test out some well-known tokens to ensure that everything is functioning as expected.&lt;/p>
&lt;p>&lt;img src="https://log.console.so/playbook/../images/playbook/ticker.png"/>&lt;/p>
&lt;h3 id="3-wallet-tracking">[3] Wallet tracking &lt;a href="#3-wallet-tracking">&lt;/a>&lt;/h3>
&lt;p>Wallet tracking is managed within the &lt;a href="https://github.com/consolelabs/account-telemetry">account-telemetry&lt;/a> repository, follow these tasks:&lt;/p>
&lt;ol>
&lt;li>&lt;strong>Verify Clickhouse Database Data&lt;/strong>:
&lt;ul>
&lt;li>Check the Clickhouse database to ensure it contains data for the new chains. Specifically, verify the &lt;code>latest_block_timestamp&lt;/code> table to confirm that it has the necessary records for the new chain.&lt;/li>
&lt;li>Ensure that the &lt;code>latest_block_timestamp&lt;/code> column is up to date and reflects the latest block timestamp for the new chain.&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;strong>Update &lt;code>utils&lt;/code> package&lt;/strong>:
&lt;ul>
&lt;li>Update the &lt;code>chain.go&lt;/code> file to add support for the new chain. This involves adding the necessary configurations and logic to handle the data retrieval and notification process for the new chain.&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ol>
&lt;p>By completing these tasks, you&amp;rsquo;ll ensure that wallet tracking in the account-telemetry repository works seamlessly with the new chains, allowing for accurate notifications to users when their tracked accounts receive new transactions.&lt;/p>
&lt;h3 id="4-show-assets-in-profile">[4] Show assets in Profile &lt;a href="#4-show-assets-in-profile">&lt;/a>&lt;/h3>
&lt;p>&lt;strong>NOTE: This is the primary step before doing any other below steps&lt;/strong>
In this part, it is essential to ensure that all widely-recognized tokens from the new chains are added to our database whitelist. To fulfill this requirement, we can follow these steps.&lt;/p>
&lt;ul>
&lt;li>&lt;code>mochi-pay-api&lt;/code>
&lt;ul>
&lt;li>Seed new chain&amp;rsquo;s info to the table &lt;code>chains&lt;/code>&lt;/li>
&lt;li>Seed tokens of new chain&amp;rsquo;s to the table &lt;code>tokens&lt;/code>
&lt;ul>
&lt;li>Find list listed tokens in the coingeko via this page &lt;a href="https://www.coingecko.com/en/all-cryptocurrencies">https://www.coingecko.com/en/all-cryptocurrencies&lt;/a> with proper filter.&lt;/li>
&lt;li>Copy content of search result and ask ChatGPT help to extract list of token symbols.&lt;/li>
&lt;li>Using result of above script as list input tokens to generate file migration, check &lt;code>mochi-pay-api/script&lt;/code> for further information.&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;code>mochi-api&lt;/code>
&lt;ul>
&lt;li>Update all utils at &lt;code>utils&lt;/code> folder to support the new chains. Such as: &lt;code>ConvertInputToChainId&lt;/code>, &lt;code>ConvertChainToChainId&lt;/code> â€¦&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;h3 id="5-transfer--tip--airdrop--payme--paylink">[5] Transfer / Tip / Airdrop / Payme / Paylink &lt;a href="#5-transfer--tip--airdrop--payme--paylink">&lt;/a>&lt;/h3>
&lt;p>Everything must be done at &lt;strong>[4]&lt;/strong>, except also need to update list chainIds in the function &lt;code>ListOrCreate&lt;/code> of repository mochi-pay-api to support creating new inapp wallet that is used for transfer/deposit/withdraw in the Mochi.&lt;/p>
&lt;h3 id="6-withdraw">[6] Withdraw &lt;a href="#6-withdraw">&lt;/a>&lt;/h3>
&lt;p>This is actually done at &lt;strong>[4]&lt;/strong> and &lt;strong>[5]&lt;/strong>. A token can be withdrawn when it is whitelist in the DB.&lt;/p>
&lt;h3 id="7-deposit">[7] Deposit &lt;a href="#7-deposit">&lt;/a>&lt;/h3>
&lt;p>To enable support for deposits on a new chain, follow these essential steps:&lt;/p>
&lt;ol>
&lt;li>
&lt;p>&lt;strong>Compile and Deploy Deposit Contract&lt;/strong>:&lt;/p>
&lt;ul>
&lt;li>Compile the deposit contract using the contract available in the consolelabs/contract-tip-bot repository.&lt;/li>
&lt;li>Deploy the compiled deposit contract to the new chain. Ensure that the deployment is successful and that the contract is functioning as expected.&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>&lt;strong>Change Ownership to Centralized Wallet Address&lt;/strong>:&lt;/p>
&lt;ul>
&lt;li>Change the ownership of the deployed deposit contract to a centralized wallet address.&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>&lt;strong>Seed Deposit Contract Information&lt;/strong>:&lt;/p>
&lt;ul>
&lt;li>Update the &lt;code>mochi_pay_api&lt;/code> by adding information about the newly deployed deposit contract to the &lt;code>deposit_contracts&lt;/code> table. This includes details such as the contract address and other relevant information.&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>&lt;strong>Test Deposits&lt;/strong>:&lt;/p>
&lt;ul>
&lt;li>Perform testing to ensure that deposits work smoothly on the new chain. Test depositing a few tokens to verify that the deposit functionality is working as intended.&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ol></description></item></channel></rss>