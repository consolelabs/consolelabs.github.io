<!doctype html><html lang=en dir=ltr><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="by hnh, vhbien
In the rapidly evolving blockchain industry, it&rsquo;s crucial to keep up with the pace of change. Here&rsquo;s a quick overview of how we seamlessly integrate new chains into the Mochi system, with the caveat that this method is specific to EVM-based blockchains:
[ ] Product Preparation [ ] Pull raw data into clickhouse [ ] Ticker, Watchlist Token Info [ ] Wallet tracking on this new chain [ ] Show assets in profile [ ] Transfer / Tip / Airdrop / Payme / Paylink [ ] Withdraw [ ] Deposit"><meta name=theme-color media="(prefers-color-scheme: light)" content="#ffffff"><meta name=theme-color media="(prefers-color-scheme: dark)" content="#343a40"><meta name=color-scheme content="light dark"><meta property="og:title" content="Integrate new chain into Mochi"><meta property="og:description" content="by hnh, vhbien
In the rapidly evolving blockchain industry, it&rsquo;s crucial to keep up with the pace of change. Here&rsquo;s a quick overview of how we seamlessly integrate new chains into the Mochi system, with the caveat that this method is specific to EVM-based blockchains:
[ ] Product Preparation [ ] Pull raw data into clickhouse [ ] Ticker, Watchlist Token Info [ ] Wallet tracking on this new chain [ ] Show assets in profile [ ] Transfer / Tip / Airdrop / Payme / Paylink [ ] Withdraw [ ] Deposit"><meta property="og:type" content="article"><meta property="og:url" content="https://consolelabs.github.io/playbook/integrate-new-chains/"><meta property="article:section" content="playbook"><meta property="article:published_time" content="2023-09-11T00:00:00+00:00"><meta property="article:modified_time" content="2023-09-11T00:00:00+00:00"><title>Integrate new chain into Mochi | Console Labs</title><link rel=manifest href=/manifest.json><link rel=icon href=/favicon.png><link rel=stylesheet href=/book.min.33a48f5432973b8ff9a82679d9e45d67f2c15d4399bd2829269455cfe390b5e8.css integrity="sha256-M6SPVDKXO4/5qCZ52eRdZ/LBXUOZvSgpJpRVz+OQteg=" crossorigin=anonymous><script defer src=/flexsearch.min.js></script>
<script defer src=/en.search.min.0a14ec377380dfe8b7cdc3650c9c1664f743c967f84eec03ea07768394c9114f.js integrity="sha256-ChTsN3OA3+i3zcNlDJwWZPdDyWf4TuwD6gd2g5TJEU8=" crossorigin=anonymous></script></head><body dir=ltr><input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control><main class="container flex"><aside class=book-menu><div class=book-menu-content><nav><h2 class=book-brand><a class="flex align-center" href=/><span>Console Labs</span></a></h2><div class=book-search><input type=text id=book-search-input placeholder=Search aria-label=Search maxlength=64 data-hotkeys=s/><div class="book-search-spinner hidden"></div><ul id=book-search-results></ul></div></nav><script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script></div></aside><div class=book-page><header class=book-header><div class="flex align-center justify-between"><label for=menu-control><img src=/svg/menu.svg class=book-icon alt=Menu></label>
<strong>Integrate new chain into Mochi</strong>
<label for=toc-control><img src=/svg/toc.svg class=book-icon alt="Table of Contents"></label></div><aside class="hidden clearfix"><nav id=TableOfContents><ul><li><ul><li><a href=#0-product-preparation>[0] Product Preparation</a></li><li><a href=#1-pull-raw-data-into-clickhouse>[1] Pull raw data into clickhouse</a></li><li><a href=#2-ticker-watchlist-and-token-info>[2] Ticker, watchlist and Token info</a></li><li><a href=#3-wallet-tracking>[3] Wallet tracking</a></li><li><a href=#4-show-assets-in-profile>[4] Show assets in Profile</a></li><li><a href=#5-transfer--tip--airdrop--payme--paylink>[5] Transfer / Tip / Airdrop / Payme / Paylink</a></li><li><a href=#6-withdraw>[6] Withdraw</a></li><li><a href=#7-deposit>[7] Deposit</a></li></ul></li></ul></nav></aside></header><article class=markdown><p>by hnh, vhbien</p><p>In the rapidly evolving blockchain industry, it&rsquo;s crucial to keep up with the pace of change. Here&rsquo;s a quick overview of how we seamlessly integrate new chains into the Mochi system, with the caveat that this method is specific to EVM-based blockchains:</p><p>[ ] Product Preparation
[ ] Pull raw data into clickhouse
[ ] Ticker, Watchlist Token Info
[ ] Wallet tracking on this new chain
[ ] Show assets in profile
[ ] Transfer / Tip / Airdrop / Payme / Paylink
[ ] Withdraw
[ ] Deposit</p><h3 id=0-product-preparation>[0] Product Preparation
<a class=anchor href=#0-product-preparation>#</a></h3><p>In this section, most of the tasks require manual handling.</p><p><strong>Add new chain to supported chain list</strong></p><ol><li>Go to <a href=https://github.com/consolelabs/mochi-pay-api>Mochi Pay</a> repository.</li><li>Create a migration file as show below.</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#66d9ef>INSERT</span> <span style=color:#66d9ef>INTO</span> <span style=color:#e6db74>&#34;public&#34;</span>.<span style=color:#e6db74>&#34;product_supported_chains&#34;</span> (<span style=color:#e6db74>&#34;chain_id&#34;</span>, <span style=color:#e6db74>&#34;name&#34;</span>, <span style=color:#e6db74>&#34;symbol&#34;</span>, <span style=color:#e6db74>&#34;rpc&#34;</span>, <span style=color:#e6db74>&#34;explorer&#34;</span>, <span style=color:#e6db74>&#34;icon&#34;</span>, <span style=color:#e6db74>&#34;is_evm&#34;</span>,) <span style=color:#66d9ef>VALUES</span>
</span></span><span style=display:flex><span>(<span style=color:#e6db74>&#39;1&#39;</span>, <span style=color:#e6db74>&#39;Ethereum Mainnet&#39;</span>, <span style=color:#e6db74>&#39;ETH&#39;</span>, <span style=color:#e6db74>&#39;https://eth.llamarpc.com&#39;</span>, <span style=color:#e6db74>&#39;https://etherscan.io&#39;</span>, <span style=color:#e6db74>&#39;https://cdn.discordapp.com/emojis/928216430451761172.png?size=240&amp;quality=lossless&#39;</span>, <span style=color:#e6db74>&#39;t&#39;</span>),
</span></span></code></pre></div><ol start=3><li>use the /chains command to see the new changes.</li></ol><p><strong>Add token emojis</strong>
To enhance the aesthetics of Mochi, we aim to display token emojis whenever possible. Currently, please reach out to @minh_cloud for assistance with this task.</p><h3 id=1-pull-raw-data-into-clickhouse>[1] Pull raw data into clickhouse
<a class=anchor href=#1-pull-raw-data-into-clickhouse>#</a></h3><p>To store blockchain raw events data in ClickHouse, follow these steps:</p><ol><li>Go to <a href=https://github.com/consolelabs/infrastructure>Infras</a> repository</li><li>Create a service with the following configuration, similar to the <a href=https://github.com/consolelabs/infrastructure/tree/main/data-warehouse>example</a></li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>evm</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>chainName</span>: <span style=color:#ae81ff>base</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>chainId</span>: <span style=color:#ae81ff>8453</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>rpcServers</span>:
</span></span><span style=display:flex><span>    - <span style=color:#ae81ff>https://1rpc.io/base</span>
</span></span><span style=display:flex><span>    - <span style=color:#ae81ff>https://base.meowrpc.com</span>
</span></span><span style=display:flex><span>    - <span style=color:#ae81ff>https://mainnet.base.org</span>
</span></span><span style=display:flex><span>    - <span style=color:#ae81ff>https://base.blockpi.network/v1/rpc/public</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>syncFromBlockNumber</span>: <span style=color:#ae81ff>2769582</span>
</span></span></code></pre></div><h3 id=2-ticker-watchlist-and-token-info>[2] Ticker, watchlist and Token info
<a class=anchor href=#2-ticker-watchlist-and-token-info>#</a></h3><p>This step should work automatically. Simply go to Mochi Clients and test out some well-known tokens to ensure that everything is functioning as expected.</p><p><img src=/playbook/../images/playbook/ticker.png></p><h3 id=3-wallet-tracking>[3] Wallet tracking
<a class=anchor href=#3-wallet-tracking>#</a></h3><p>Wallet tracking is managed within the <a href=https://github.com/consolelabs/account-telemetry>account-telemetry</a> repository, , follow these tasks:</p><ol><li><strong>Verify Clickhouse Database Data</strong>:<ul><li>Check the Clickhouse database to ensure it contains data for the new chains. Specifically, verify the latest_block_timestamp table to confirm that it has the necessary records for the new chain.</li><li>Ensure that the latest_block_timestamp column is up to date and reflects the latest block timestamp for the new chain.</li></ul></li><li><strong>Update <code>utils</code> package</strong>:<ul><li>Update the chain.go file to add support for the new chain. This involves adding the necessary configurations and logic to handle the data retrieval and notification process for the new chain.</li></ul></li></ol><p>By completing these tasks, you&rsquo;ll ensure that wallet tracking in the account-telemetry repository works seamlessly with the new chains, allowing for accurate notifications to users when their tracked accounts receive new transactions.</p><h3 id=4-show-assets-in-profile>[4] Show assets in Profile
<a class=anchor href=#4-show-assets-in-profile>#</a></h3><h3 id=5-transfer--tip--airdrop--payme--paylink>[5] Transfer / Tip / Airdrop / Payme / Paylink
<a class=anchor href=#5-transfer--tip--airdrop--payme--paylink>#</a></h3><p>This step should work automatically. Simply go to Mochi Clients and test out some well-known tokens to ensure that everything is functioning as expected.</p><h3 id=6-withdraw>[6] Withdraw
<a class=anchor href=#6-withdraw>#</a></h3><p>This step should work automatically. Simply go to Mochi Clients and test out some well-known tokens to ensure that everything is functioning as expected.</p><h3 id=7-deposit>[7] Deposit
<a class=anchor href=#7-deposit>#</a></h3><p>To enable support for deposits on a new chain, follow these essential steps:</p><ol><li><p><strong>Compile and Deploy Deposit Contract</strong>:</p><ul><li>Compile the deposit contract using the contract available in the consolelabs/contract-tip-bot repository.</li><li>Deploy the compiled deposit contract to the new chain. Ensure that the deployment is successful and that the contract is functioning as expected.</li></ul></li><li><p><strong>Change Ownership to Centralized Wallet Address</strong>:</p><ul><li>Change the ownership of the deployed deposit contract to a centralized wallet address.</li></ul></li><li><p><strong>Seed Deposit Contract Information</strong>:</p><ul><li>Update the mochi_pay_api by adding information about the newly deployed deposit contract to the deposit_contracts table. This includes details such as the contract address and other relevant information.</li></ul></li><li><p><strong>Test Deposits</strong>:</p><ul><li>Perform testing to ensure that deposits work smoothly on the new chain. Test depositing a few tokens to verify that the deposit functionality is working as intended.</li></ul></li></ol></article><footer class=book-footer><div class="flex flex-wrap justify-between"></div><script>(function(){function e(e){const t=window.getSelection(),n=document.createRange();n.selectNodeContents(e),t.removeAllRanges(),t.addRange(n)}document.querySelectorAll("pre code").forEach(t=>{t.addEventListener("click",function(){if(window.getSelection().toString())return;e(t.parentElement),navigator.clipboard&&navigator.clipboard.writeText(t.parentElement.textContent)})})})()</script></footer><div class=book-comments></div><label for=menu-control class="hidden book-menu-overlay"></label></div><aside class=book-toc><div class=book-toc-content><nav id=TableOfContents><ul><li><ul><li><a href=#0-product-preparation>[0] Product Preparation</a></li><li><a href=#1-pull-raw-data-into-clickhouse>[1] Pull raw data into clickhouse</a></li><li><a href=#2-ticker-watchlist-and-token-info>[2] Ticker, watchlist and Token info</a></li><li><a href=#3-wallet-tracking>[3] Wallet tracking</a></li><li><a href=#4-show-assets-in-profile>[4] Show assets in Profile</a></li><li><a href=#5-transfer--tip--airdrop--payme--paylink>[5] Transfer / Tip / Airdrop / Payme / Paylink</a></li><li><a href=#6-withdraw>[6] Withdraw</a></li><li><a href=#7-deposit>[7] Deposit</a></li></ul></li></ul></nav></div></aside></main></body></html>