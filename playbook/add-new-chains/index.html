<!doctype html><html lang=en-us><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=author content><meta name=description property="og:description" content><meta name=keywords content><meta property="og:type" content="website"><meta property="og:url" content="https://log.console.so/playbook/add-new-chains/"><meta property="og:image" content="https://log.console.so/img/ConsoleLabs_logo_1.jpg"><link rel=icon type=image/x-icon href=https://log.console.so/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://log.console.so/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://log.console.so/favicon-32x32.png><link rel=apple-touch-icon href=https://log.console.so/apple-touch-icon.png><title>Integrate new chain | Console Labs</title><meta name=description content><link rel=canonical href=https://log.console.so/playbook/add-new-chains/><link rel="shortcut icon" type=image/png href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mNk+A8AAQUBAScY42YAAAAASUVORK5CYII="><style>:root{--primary-color:#45f1a6;--primary-color-light:#2ea370;--nav-sidebar-width:200px;--nav-sidebar-offset:40px}body{font:16px sans-serif;color:#000;text-rendering:optimizeLegibility;padding:2rem;max-width:100%;margin:0;padding:0;background-color:#fff;line-height:25px;min-height:100vh;display:flex;flex-direction:column;overflow-wrap:break-word;hyphens:auto}h1,h2,h3,h4{color:var(--primary-color)}h1{font-size:45px;display:none}h2{font-size:30px}h3{font-size:20px}h4{font-size:15px}q{font-size:20px;max-width:500px;display:block;margin-left:30px}pre{font-family:monospace;background:#000;color:#fff;padding:15px;border-radius:2px;overflow-x:auto}pre>code{display:block;text-indent:0;white-space:inherit;font-weight:400}code{font-family:monospace;font-size:12px;background:#000;color:#fff;padding:2px 5px;white-space:pre;border-radius:2px;font-weight:700;display:inline-block;line-height:16px}code comment{color:#777}code.button{background:#fff;color:#000;font-size:smaller;display:inline-block;padding:0 6px;font-weight:700;border-radius:2px;line-height:22px}a[href*="#"]{text-decoration:none}nav.menu{float:left;padding:45px;max-width:var(--nav-sidebar-width);line-height:22px;margin-top:-2px}nav .site-nav{margin:20px 0;display:block}nav .site-nav section{float:left;margin-top:-2px}nav .site-nav section h2{margin:20px 0;font-size:24px;text-transform:lowercase}nav.menu details summary{margin-bottom:30px}@media(max-width:1100px){nav.menu{width:100%;max-width:100%}}nav.menu ul{padding:0 10px 10px 0;margin:0;list-style-type:none;line-height:22px}main{padding:45px;max-width:100%;float:left}main>ul{line-height:25px;margin:0;word-break:break-all}main>ul>li>a{text-decoration:underline}.dual-list>ul{columns:2}.single-list>ul{columns:2}.profile img{width:100px;height:100px;object-fit:cover;aspect-ratio:1/1}.profile object{width:100px;height:100px;object-fit:cover;aspect-ratio:1/1}table,th,td{border:1px solid;border-collapse:collapse;border-spacing:0}tr{max-height:100px;max-width:100px}td{padding:0 20px;max-width:300px;max-height:100px;overflow:hidden;text-overflow:ellipsis}td:has(img){padding:0;line-height:0}#TableOfContents>ul>li>a{text-decoration:underline}#TableOfContents>ul{columns:2;line-height:20px}#TableOfContents li{list-style-type:decimal-leading-zero;list-style-position:inside;overflow:hidden;text-overflow:ellipsis}.notice{padding:20px;border:2px solid #000}main>blockquote{padding:20px;border:2px solid #000}main>*{max-width:600px;margin-bottom:30px}header{padding:45px;border-bottom:1px solid #222}header a img{filter:invert(0)}header h1{display:inline}footer{margin-top:auto;padding:45px;clear:both}nav .site-nav ul li{list-style-type:none;display:flex;font-variant-numeric:tabular-nums}li:has(input[type=checkbox]){display:block;list-style-type:none}ul:has(li input[type=checkbox]){padding:0}ul li a{overflow:hidden;text-overflow:ellipsis;width:calc(var(--nav-sidebar-width) + var(--nav-sidebar-offset));background-color:#fff}ul li a:hover{white-space:nowrap;width:100%;z-index:10}time{padding-right:1rem}blockquote{margin:1em 0;padding:0 2em;border-left:3px solid #eee}img{max-width:100%}a,a:visited{color:#000}@media(prefers-color-scheme:dark){a,a:visited{color:#fff}body{background:#000;color:#fff}header a img{filter:invert(1)}body a{color:#fff}pre{background:#fff;color:#000}code{background:#fff;color:#000}body select{color:#000;background-color:#fff}.project{border-left:2px solid #fff}.notice{border-color:#fff}.mono{filter:invert(1)}.progress>div{background-color:#fff}.progress>div>span{color:#000}main>blockquote{border-color:#fff}ul li a{white-space:nowrap;overflow:hidden;text-overflow:ellipsis;width:calc(var(--nav-sidebar-width) + var(--nav-sidebar-offset));background-color:#000}ul li a{background-color:inherit}section>ul li a{background-color:inherit}}@media(prefers-color-scheme:light){h1,h2,h3,h4{color:var(--primary-color-light)}}@media(max-width:1100px){nav{width:100%}nav .site-nav section{float:left;margin:0 10px 10px 0}}@media(max-width:1100px) and (min-width:651px){nav .site-nav section{width:calc(25% - 10px)}nav .site-nav section:nth-child(4n+1){clear:left}}@media only screen and (max-width:1100px){nav.menu{max-width:unset;width:unset;display:inline-block}#TableOfContents>ul{columns:1}main{display:inline-block;max-width:100%;width:unset}main>*{max-width:100%}}@media(max-width:350px){nav .site-nav section{width:100%}}</style><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","articleSection":"playbook","name":"Integrate new chain","headline":"Integrate new chain","alternativeHeadline":"","description":"In the rapidly evolving blockchain industry, it\u0026rsquo;s crucial to keep up with the pace of change. Here\u0026rsquo;s a quick overview of how we seamlessly integrate new chains into the Mochi system, with the caveat that this method is specific to EVM-based blockchains:\nProduct Preparation Pull raw data into clickhouse Ticker, Watchlist Token Info Wallet tracking on this new chain Show assets in profile Transfer \/ Tip \/ Airdrop \/ Payme \/ Paylink Withdraw Deposit [0] Product Preparation In this section, most of the tasks require manual handling.","inLanguage":"en-us","isFamilyFriendly":"true","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/log.console.so\/playbook\/add-new-chains\/"},"author":{"@type":"Person","name":"Han Ngo"},"creator":{"@type":"Person","name":"Han Ngo"},"accountablePerson":{"@type":"Person","name":"Han Ngo"},"copyrightHolder":"Console Labs","copyrightYear":"2023","date":"2023-09-11T00:00:00.00Z","dateCreated":"2023-09-11T00:00:00.00Z","datePublished":"2023-09-11T00:00:00.00Z","dateModified":"2023-09-11T00:00:00.00Z","publisher":{"@type":"Organization","name":"Console Labs","url":"https://log.console.so/","logo":{"@type":"ImageObject","url":"https:\/\/log.console.so\/","width":"32","height":"32"}},"image":"https://log.console.so/","url":"https:\/\/log.console.so\/playbook\/add-new-chains\/","wordCount":"704","genre":["data","blockchain","guideline"],"keywords":["data","blockchain","guideline"]}</script><style>body{visibility:hidden;opacity:0}</style><noscript><style>body{visibility:visible;opacity:1}</style></noscript><script type=text/javascript>window.addEventListener("DOMContentLoaded",function(){document.body.style.visibility="visible",document.body.style.opacity=1})</script></head><body class=playbook><header><a href=/><img src=https://log.console.so/img/ConsoleLabs_logo.png alt=ConsoleLabs height=103px style="margin:-28px -26px"></a></header><div><nav class=menu><details open><summary>Menu</summary><section class=site-nav><section><ul><li><a href=/about/>About Us</a></li><li><a href=/contributors/>Contributors</a></li><li><a href=/site-index/>Index</a></li><li><a href=/philosophy/>Philosophy</a></li><li><a href=/purpose/>Purpose</a></li></ul></section><section><h2>experiments</h2><ul><li><a href=/experiments/emoji/>Emoji</a></li><li><a href=/experiments/neko/>Neko NFT</a></li><li><a href=/experiments/rabby/>Rabby NFT</a></li><li><a href=/experiments/wagmi/>WAGMI comics</a></li></ul></section><section><h2>blog</h2><ul><li><a href=/blog/log/>Log</a></li><li><a href=/blog/shape-up/>Shape Up</a></li></ul></section><section><h2>playbook</h2><ul><li><a href=/playbook/api-first/>API-first development</a></li><li><a href=/playbook/ci-cd/>Continuous Integration</a></li><li><a href=/playbook/data-layer/>Data layer</a></li><li><a href=/playbook/format-profile-number/>Format a Neko profile</a></li><li><a href=/playbook/render-emoji/>How to work with emoji on Discord</a></li><li><a href=/playbook/add-new-chains/>Integrate new chain</a></li><li><a href=/playbook/meaningful-commit/>Meaningful commit message</a></li><li><a href=/playbook/shared-ui-lib/>Shared UI library in multiple platforms</a></li></ul></section></section></details></nav><main><aside class=authors>by
<a href=/members/hnh>hnh</a>,
<a href=/members/vhbien>vhbien</a></aside><aside class=toc><nav id=TableOfContents><ul><li><a href=#0-product-preparation>[0] Product Preparation</a></li><li><a href=#1-pull-raw-data-into-clickhouse>[1] Pull raw data into clickhouse</a></li><li><a href=#2-ticker-watchlist-and-token-info>[2] Ticker, watchlist and Token info</a></li><li><a href=#3-wallet-tracking>[3] Wallet tracking</a></li><li><a href=#4-show-assets-in-profile>[4] Show assets in Profile</a></li><li><a href=#5-transfer--tip--airdrop--payme--paylink>[5] Transfer / Tip / Airdrop / Payme / Paylink</a></li><li><a href=#6-withdraw>[6] Withdraw</a></li><li><a href=#7-deposit>[7] Deposit</a></li></ul></nav></aside><p>In the rapidly evolving blockchain industry, it&rsquo;s crucial to keep up with the pace of change. Here&rsquo;s a quick overview of how we seamlessly integrate new chains into the Mochi system, with the caveat that this method is specific to EVM-based blockchains:</p><ul><li><input disabled type=checkbox> Product Preparation</li><li><input disabled type=checkbox> Pull raw data into clickhouse</li><li><input disabled type=checkbox> Ticker, Watchlist Token Info</li><li><input disabled type=checkbox> Wallet tracking on this new chain</li><li><input disabled type=checkbox> Show assets in profile</li><li><input disabled type=checkbox> Transfer / Tip / Airdrop / Payme / Paylink</li><li><input disabled type=checkbox> Withdraw</li><li><input disabled type=checkbox> Deposit</li></ul><h2 id=0-product-preparation><a href=#0-product-preparation>[0] Product Preparation <a href=#0-product-preparation></a></a></h2><p>In this section, most of the tasks require manual handling.</p><p><strong>Add new chain to supported chain list</strong></p><ol><li>Go to <a href=https://github.com/consolelabs/mochi-pay-api>Mochi Pay</a> repository.</li><li>Create a migration file as show below.</li></ol><pre><code class=language-sql>INSERT INTO &quot;public&quot;.&quot;product_supported_chains&quot; (&quot;chain_id&quot;, &quot;name&quot;, &quot;symbol&quot;, &quot;rpc&quot;, &quot;explorer&quot;, &quot;icon&quot;, &quot;is_evm&quot;,) VALUES
('1', 'Ethereum Mainnet', 'ETH', 'https://eth.llamarpc.com', 'https://etherscan.io', 'https://cdn.discordapp.com/emojis/928216430451761172.png?size=240&amp;quality=lossless', 't'),
</code></pre><ol start=3><li>use the <code>/chains</code> command to see the new changes.</li></ol><p><strong>Add token emojis</strong>
To enhance the aesthetics of Mochi, we aim to display token emojis whenever possible. Currently, please reach out to <code>@minh_cloud</code> for assistance with this task.</p><h2 id=1-pull-raw-data-into-clickhouse><a href=#1-pull-raw-data-into-clickhouse>[1] Pull raw data into clickhouse <a href=#1-pull-raw-data-into-clickhouse></a></a></h2><p>To store blockchain raw events data in ClickHouse, follow these steps:</p><ol><li>Go to <a href=https://github.com/consolelabs/infrastructure>Infras</a> repository</li><li>Create a service with the following configuration, similar to the <a href=https://github.com/consolelabs/infrastructure/tree/main/data-warehouse>example</a></li></ol><pre><code class=language-yaml>evm:
  chainName: base
  chainId: 8453
  rpcServers:
    - https://1rpc.io/base
    - https://base.meowrpc.com
    - https://mainnet.base.org
    - https://base.blockpi.network/v1/rpc/public
  syncFromBlockNumber: 2769582
</code></pre><h2 id=2-ticker-watchlist-and-token-info><a href=#2-ticker-watchlist-and-token-info>[2] Ticker, watchlist and Token info <a href=#2-ticker-watchlist-and-token-info></a></a></h2><p>This step should work automatically. Simply go to Mochi Clients and test out some well-known tokens to ensure that everything is functioning as expected.</p><p><img src=/playbook/../images/playbook/ticker.png onerror='this.onerror=null,this.src="/images/experiments/neko/neko-first-version.jpeg"'></p><h2 id=3-wallet-tracking><a href=#3-wallet-tracking>[3] Wallet tracking <a href=#3-wallet-tracking></a></a></h2><p>Wallet tracking is managed within the <a href=https://github.com/consolelabs/account-telemetry>account-telemetry</a> repository, follow these tasks:</p><ol><li><strong>Verify Clickhouse Database Data</strong>:<ul><li>Check the Clickhouse database to ensure it contains data for the new chains. Specifically, verify the <code>latest_block_timestamp</code> table to confirm that it has the necessary records for the new chain.</li><li>Ensure that the <code>latest_block_timestamp</code> column is up to date and reflects the latest block timestamp for the new chain.</li></ul></li><li><strong>Update <code>utils</code> package</strong>:<ul><li>Update the <code>chain.go</code> file to add support for the new chain. This involves adding the necessary configurations and logic to handle the data retrieval and notification process for the new chain.</li></ul></li></ol><p>By completing these tasks, you&rsquo;ll ensure that wallet tracking in the account-telemetry repository works seamlessly with the new chains, allowing for accurate notifications to users when their tracked accounts receive new transactions.</p><h2 id=4-show-assets-in-profile><a href=#4-show-assets-in-profile>[4] Show assets in Profile <a href=#4-show-assets-in-profile></a></a></h2><p><strong>NOTE: This is the primary step before doing any other below steps</strong>
In this part, it is essential to ensure that all widely-recognized tokens from the new chains are added to our database whitelist. To fulfill this requirement, we can follow these steps.</p><ul><li><code>mochi-pay-api</code><ul><li>Seed new chain&rsquo;s info to the table <code>chains</code></li><li>Seed tokens of new chain&rsquo;s to the table <code>tokens</code><ul><li>Find list listed tokens in the coingeko via this page <a href=https://www.coingecko.com/en/all-cryptocurrencies>https://www.coingecko.com/en/all-cryptocurrencies</a> with proper filter.</li><li>Copy content of search result and ask ChatGPT help to extract list of token symbols.</li><li>Using result of above script as list input tokens to generate file migration, check <code>mochi-pay-api/script</code> for further information.</li></ul></li></ul></li><li><code>mochi-api</code><ul><li>Update all utils at <code>utils</code> folder to support the new chains. Such as: <code>ConvertInputToChainId</code>, <code>ConvertChainToChainId</code> …</li></ul></li></ul><h2 id=5-transfer--tip--airdrop--payme--paylink><a href=#5-transfer--tip--airdrop--payme--paylink>[5] Transfer / Tip / Airdrop / Payme / Paylink <a href=#5-transfer--tip--airdrop--payme--paylink></a></a></h2><p>Everything must be done at <strong>[4]</strong>, except also need to update list chainIds in the function <code>ListOrCreate</code> of repository mochi-pay-api to support creating new inapp wallet that is used for transfer/deposit/withdraw in the Mochi.</p><h2 id=6-withdraw><a href=#6-withdraw>[6] Withdraw <a href=#6-withdraw></a></a></h2><p>This is actually done at <strong>[4]</strong> and <strong>[5]</strong>. A token can be withdrawn when it is whitelist in the DB.</p><h2 id=7-deposit><a href=#7-deposit>[7] Deposit <a href=#7-deposit></a></a></h2><p>To enable support for deposits on a new chain, follow these essential steps:</p><ol><li><p><strong>Compile and Deploy Deposit Contract</strong>:</p><ul><li>Compile the deposit contract using the contract available in the consolelabs/contract-tip-bot repository.</li><li>Deploy the compiled deposit contract to the new chain. Ensure that the deployment is successful and that the contract is functioning as expected.</li></ul></li><li><p><strong>Change Ownership to Centralized Wallet Address</strong>:</p><ul><li>Change the ownership of the deployed deposit contract to a centralized wallet address.</li></ul></li><li><p><strong>Seed Deposit Contract Information</strong>:</p><ul><li>Update the <code>mochi_pay_api</code> by adding information about the newly deployed deposit contract to the <code>deposit_contracts</code> table. This includes details such as the contract address and other relevant information.</li></ul></li><li><p><strong>Test Deposits</strong>:</p><ul><li>Perform testing to ensure that deposits work smoothly on the new chain. Test depositing a few tokens to verify that the deposit functionality is working as intended.</li></ul></li></ol></main></div></body></html><footer><hr><span style=float:right>Edited on Sep 11, 2023<br></span><b>Console Labs</b> © 2023 — <a href=https://github.com/consolelabs/consolelabs.github.io/blob/main/LICENSE.by-nc-sa-4.0.md target=_blank>BY-NC-SA 4.0</a></footer>